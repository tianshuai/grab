-- MySQL dump 10.13  Distrib 5.5.32, for debian-linux-gnu (x86_64)
--
-- Host: localhost    Database: grab
-- ------------------------------------------------------
-- Server version	5.5.32-0ubuntu0.12.04.1

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `sites`
--

DROP TABLE IF EXISTS `sites`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sites` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `mark` varchar(20) NOT NULL,
  `url` varchar(100) NOT NULL,
  `keyword` varchar(50) DEFAULT NULL,
  `tags` varchar(100) DEFAULT NULL,
  `kind` int(1) NOT NULL DEFAULT '1',
  `state` int(1) NOT NULL DEFAULT '1',
  `created_at` date DEFAULT NULL,
  `updated_at` date DEFAULT NULL,
  `match_tags` varchar(50) DEFAULT NULL,
  `ignore_tags` varchar(50) DEFAULT NULL,
  `conf` text,
  `sleep` int(3) DEFAULT '3',
  `is_subdomain` int(1) DEFAULT '0',
  `remarks` varchar(150) DEFAULT NULL,
  `is_filter_param` int(1) DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `mark` (`mark`),
  UNIQUE KEY `url` (`url`),
  KEY `state` (`state`),
  KEY `kind` (`kind`)
) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sites`
--

LOCK TABLES `sites` WRITE;
/*!40000 ALTER TABLE `sites` DISABLE KEYS */;
INSERT INTO `sites` VALUES (8,'shuff_室内家具','shuff','http://www.designshuffle.com/','div#ds_album_title',NULL,1,1,'2013-11-06','2013-11-22','\\/portfolio\\/[^\\/|\\.|\\?]+$','\\/blogview\\/','#选择器: \\/portfolio\\/ \\/blogview\\/\r\n#http://joannacrain.designshuffle.com\r\n#http://detailsadesignfirm.designshuffle.com\r\n#http://jgdevelopment.designshuffle.com/\r\n#http://betterdecoratingbible.designshuffle.com\r\n#http://ashley-salzmann.designshuffle.com\r\n#http://mlawlorcooper.designshuffle.com\r\n#http://budgetblonde.designshuffle.com\r\n#http://lindseygregory.designshuffle.com\r\n#http://torontointeriordesigner.designshuffle.com\r\n#\r\n\r\n\r\n#标题\r\nif doc.css(\"div#ds_album_title\").present?\r\n  page_title = doc.css(\"div#ds_album_title\").first.content\r\nend\r\n\r\n\r\n#描述\r\nif doc.css(\"div.album-caption\").present?\r\n  page_desc = doc.css(\"div.album-caption\").first.content\r\nend\r\n\r\n#图片组\r\n page_content = doc.css(\'html\')\r\n   if page_content.present?\r\n        page_content = page_content.first\r\n	img_arr = []\r\n        sh = /dsz\\.contents\\.push\\(new\\sdse\\_content\\([^;]*/imx\r\n	arr =  page_content.content.scan(sh)\r\n	if arr .present?\r\n	  arr.each do |d|\r\n            d = d.gsub(/\\[.*\\]/, \'\')\r\n            d = d.gsub(\'\"\', \'\')\r\n	    url_arr = d.split(\',\')\r\n	    if url_arr.is_a?(Array)\r\n              img_arr << \"#{url_arr[2].strip}@@#{url_arr[5].strip}\"\r\n	    end\r\n	  end\r\n          page_images = img_arr.join(\'##\')\r\n        end\r\n  end',5,1,NULL,0),(10,'boom','boom','http://www.designboom.com/','div#SingleLoopContainer',NULL,1,1,'2013-11-06','2013-11-20','architecture','gallery\\/image','#选择器:div#SingleLoopContainer\r\n#标题\r\nif doc.css(\"h1#PreHeaderContainer\").present?\r\n  page_title = doc.css(\"h1#PreHeaderContainer\").first.content\r\nend\r\n\r\n#封面图url\r\nif doc.css(\"div.SingleBigImage img\").present?\r\n  page_cover_img = doc.css(\"div.SingleBigImage img\").first[\'src\'] + \'@@\' + \' \'\r\nend\r\n\r\n#描述\r\nif doc.css(\"div.SingleArticleMainDescriptionNew\").present?\r\n  page_content = doc.css(\"div.SingleArticleMainDescriptionNew\").first\r\nelsif doc.css(\"div.SingleArticleMainDescription\").present?\r\n  page_content = doc.css(\"div.SingleArticleMainDescription\").first\r\nend\r\n\r\n  if page_content.present?\r\n	img_arr = []\r\n	desc_arr = []\r\n	page_content.css(\'p\').each_with_index do |d,index|\r\n       if d.css(\'img\').present?\r\n         if d.css(\'img\').size > 1\r\n           d.css(\'img\').each do |d|\r\n             img = d[\'src\']\r\n              if img[0]==\'/\'\r\n                img = File.join(site_url, img)\r\n              end\r\n	     if d.next.present? and d.next.next.present?\r\n	       desc = d.next.next.text\r\n	     else\r\n	       desc = \'\'\r\n	     end\r\n	     img_arr << \"#{img}@@#{desc}\"\r\n           end\r\n         elsif d.css(\'img\').size==1\r\n	      img = d.css(\'img\').first[\'src\']\r\n              if img[0]==\'/\'\r\n                img = File.join(site_url, img)\r\n              end\r\n	      desc = d.text\r\n	      img_arr << \"#{img}@@#{desc}\"\r\n           end\r\n         else\r\n	  desc_arr << d.text\r\n	end #if d.css(img).present?\r\n	end #page_content.css(p) loop end\r\n	page_desc = desc_arr.join(\'##\')\r\n	page_images = page_cover_img + \'##\' + img_arr.join(\'##\')\r\n  end',5,0,NULL,0),(11,'boom_中文','boom_cn','http://cn.designboom.com/','font.arial18',NULL,1,1,'2013-11-22','2013-11-27','\\/view\\/','\\/weblog\\/','#描述\r\nif doc.css(\"font.arial18\").present?\r\n  page_title = doc.css(\"font.arial18\").first.content\r\n  page_content = doc.send(\'css\', \'font.arial18\').first.parent\r\n  #page_desc = page_desc.gsub(/<script.*?>.*?<\\\\/script>/imx, \'\')\r\n  #page_desc = page_desc.gsub(/<style.*?>.*?<\\\\/style>/imx, \'\')\r\n  #不加?贪婪模式\r\n  #page_desc = page_desc.gsub(/<table.*?>.*<\\\\/table>/imx, \'\')\r\n\r\n  if page_content.present?\r\n	img_arr = []\r\n	desc_arr = []\r\n\r\n	page_content.css(\'p\').each_with_index do |d,index|\r\n	  if d.css(\'img\').present?\r\n		if d.css(\'img\').size > 1\r\n			d.css(\'img\').each do |d|\r\n                          img = d[\'src\']\r\n                          if d[\'src\'][0]== \'/\'\r\n			    img = File.join(site_url, d[\'src\'])\r\n                          end\r\n			  if d.next.present? and d.next.next.present?\r\n				desc = d.next.next.text\r\n			  else\r\n				desc = \' \'\r\n			  end\r\n			  img_arr << \"#{img}@@#{desc}\"\r\n			end\r\n		else\r\n                  img = d.css(\'img\').first[\'src\']\r\n                  if img[0]== \'/\'\r\n	             img = File.join(site_url, img)\r\n                  end\r\n		  \r\n		  desc = d.text\r\n		  img_arr << \"#{img}@@#{desc}\"\r\n		end\r\n	  else\r\n		desc_arr << d.text\r\n	  end #if d.css(img).present?\r\n	end #page_content.css(\'p\') loop end\r\n      \r\n        if img_arr.blank?\r\n          page_content.css(\'img\').each do |d|\r\n            img = d[\'src\']\r\n            if d[\'src\'][0]== \'/\'\r\n	      img = File.join(site_url, d[\'src\'])\r\n            end\r\n	    if d.next.present? and d.next.next.present?\r\n		desc = d.next.next.text\r\n	    else\r\n		desc = \' \'\r\n	    end\r\n	    img_arr << \"#{img}@@#{desc}\"\r\n          end\r\n        end\r\n	page_desc = desc_arr.join(\'##\')\r\n	page_images = img_arr.join(\'##\')\r\n  end\r\nend',3,0,'(完)',0),(12,'香港設計師資訊網','designerhk','http://www.designerhk.com/','div#content-area .content .field .field-items',NULL,1,1,'2013-11-22','2013-11-25','\\/blog\\/','','#title\r\nif doc.css(\"div#content-header h1.title\").present?\r\n  page_title = doc.css(\"div#content-header h1.title\").first.content\r\nend\r\n\r\n#描述\r\nif doc.css(\"div#content-area .content\").present?\r\n  page_content = []\r\n  img_arr = []\r\n  desc_arr = []\r\n  tag_arr = []\r\n  doc.css(\"div#content-area .content p\").each do |d|\r\n    desc_arr << d.content\r\n  end\r\n\r\n  #图片\r\n  doc.css(\'div#content-area .content .field .field-items .field-item\').each do |d|\r\n    if d.css(\'a\').present?\r\n      img = d.css(\'a\').first[\'href\']\r\n      img_arr << img + \'@@ \'\r\n    end\r\n  end\r\n\r\n  #标签\r\n  doc.css(\'div#content-area .terms ul li a\').each do |d|\r\n    tag_arr << d.text\r\n  end\r\n\r\n  page_desc = desc_arr.join(\'##\')\r\n  page_images = img_arr.join(\'##\')\r\n  page_tags = tag_arr.join(\'##\')\r\nend',8,0,NULL,0),(13,'2LDESIGN—设计现场 sohu_blog','2ldesign','http://2ldesign.blog.sohu.com/entry/','div#main-content img',NULL,1,1,'2013-11-25','2013-11-27','','','#\\/blog\\/view\\/  \\/entry\\/\r\n#标题\r\nif doc.at_css(\'div#entry .item-body .newBlog-title h2\').present?\r\n  page_title = doc.at_css(\'div#entry .item-body .newBlog-title h2\').text\r\n  page_title = page_title.strip\r\nend\r\n\r\n#描述\r\nif doc.css(\'div#main-content\').present?\r\n  img_arr = []\r\n  page_desc = doc.at_css(\'div#main-content\').text\r\n  page_desc = page_desc.gsub(/体验新版博客.*/imx, \'\')\r\n\r\n  #图片组\r\n  if doc.css(\'div#main-content img\').present?\r\n    doc.css(\'div#main-content img\').each do |d|\r\n      img_arr << d[\'src\'] + \'@@ \'\r\n    end\r\n    page_images = img_arr.join(\'##\')\r\n  end\r\nend\r\n\r\n#标签\r\nif doc.css(\'div#entry .item-body .newBlog-title-sort a\').present?\r\n  tag_arr = []\r\n  doc.css(\'div#entry .item-body .newBlog-title-sort a\').each do |d|\r\n    tag_arr << d.text\r\n  end\r\n  page_tags = tag_arr.join(\'##\')\r\nend',3,0,'完',0),(14,'陆俊毅—设计现场 sina_blog','lzy_sina','http://blog.sina.com.cn/designerlujunyi','div#articlebody',NULL,1,0,'2013-11-25','2013-11-27','','','#\\/blog\\/view\\/  \\/entry\\/  div#articlebody  designerlujunyi\r\n#标题\r\nif doc.at_css(\'articlebody .titName\').present?\r\n  page_title = doc.at_css(\'articlebody h2.titName\').text\r\n  page_title = page_title.strip\r\nputs \'11111\'\r\nputs page_title\r\nend\r\n\r\n#描述\r\nif doc.css(\'div#sina_keyword_ad_area2\').present?\r\n  img_arr = []\r\n  page_desc = doc.at_css(\'div#sina_keyword_ad_area2\').text\r\n\r\n  #图片组\r\n  if doc.css(\'div#sina_keyword_ad_area2 a\').present?\r\n    doc.css(\'div#sina_keyword_ad_area2 a\').each do |d|\r\n      img_arr << d[\'href\'] + \'@@ \'\r\n    end\r\n    page_images = img_arr.join(\'##\')\r\n  end\r\nend\r\n\r\n#标签\r\nif doc.css(\'td.blog_tag a\').present?\r\n  tag_arr = []\r\n  doc.css(\'td.blog_tag a\').each do |d|\r\n    tag_arr << d.text\r\n  end\r\n  page_tags = tag_arr.join(\'##\')\r\nend',5,0,'(编码问题:保留)',0),(15,'72dpi','72dpi','http://72dpi.cn/','div#content .post .entry img',NULL,1,1,'2013-11-26','2013-11-27','\\?p=','','#标题\r\nif doc.css(\'div#content .post h2\').present?\r\n  page_title = doc.at_css(\'div#content .post h2\').text\r\nend\r\n\r\n#图片组\r\nif doc.css(\'div#content .post .entry img\').present?\r\n  img_arr = []\r\n  doc.css(\'div#content .post .entry img\').each do |d|\r\n    img_arr << d[\'src\'] + \'@@ \'\r\n  end\r\n  page_images = img_arr.join(\'##\')\r\nend\r\n\r\n#标签\r\nif doc.css(\'div#content .post .entry p\').present?\r\n  tag_arr = []\r\n  doc.css(\'div#content .post .entry p\').each do |d|\r\n    if d.text.strip[0..3] == \'Tags\'\r\n      d.css(\'a\').collect{|x| tag_arr << x.text}\r\n    end\r\n  end\r\n\r\n  page_tags = tag_arr.join(\'##\')\r\nend',3,0,'(完)',0),(16,'artskills','artskills','http://www.artskills.net/','#singlecontent img',NULL,1,1,'2013-11-26','2013-11-26','','','#标题\r\nif doc.css(\'div#contenerbordure .titrearticlesingle\').present?\r\n  page_title = doc.at_css(\'div#contenerbordure .titrearticlesingle\').text\r\nend\r\n\r\n\r\nif doc.css(\'#singlecontent\').present?\r\n  #描述\r\n  page_desc = doc.at_css(\'#singlecontent\').text.force_encoding(\'utf-8\')\r\n\r\n  #图片组\r\n  img_arr = []\r\n  doc.css(\'#singlecontent img\').collect{|x| img_arr << x[\'src\'] + \'@@ \' }\r\n  page_images = img_arr.join(\'##\')\r\n\r\nend\r\n\r\n#标签\r\nif doc.css(\'#colonne2 .titrepagesingle a\').present?\r\n  tag_arr = []\r\n  doc.css(\'#colonne2 .titrepagesingle a\').collect{|x| tag_arr << x.text.force_encoding(\'utf-8\')}\r\n  page_tags = tag_arr.join(\'##\')\r\nend',3,0,NULL,0),(17,'halfanese','halfanese','http://halfanese.com/','div.entry .project_content',NULL,1,0,'2013-11-27','2013-11-27','','','#注:暂时不能抓取ajax获取的页面(保留)\r\n#相同规则的网站\r\n#http://halfanese.com/\r\n#http://www.stefanglerum.com/ \r\n#http://www.loladupre.com/\r\n#http://septemberlion.com/\r\n\r\n#选择器\r\n# div.entry .project_content \r\n#标题\r\npage_title = doc.at_css(\'title\').text.split(\'-\').first.strip\r\n\r\n#描述\r\nif doc.css(\'.entry .project_content img\').present?\r\n  img_arr = []\r\n  doc.css(\'.entry .project_content img\').each do |d|\r\n    if d[\'src_o\'].present?\r\n      img_arr << d[\'src_o\'] + \'@@ \'\r\n    end\r\n  end\r\nend',3,0,'(ajax保留)',0),(18,'since1984','since1984','http://since1984.cn/','#incontent .entry img',NULL,1,1,'2013-11-27','2013-11-28','\\/post\\/','','#标题\r\nif doc.css(\'#incontent .entry .intitle\').present?\r\n  page_title = doc.at_css(\'#incontent .entry .intitle\').text\r\nend\r\n\r\nif doc.css(\'#incontent .entry p\').present?\r\n  desc_arr,img_arr,tag_arr = [],[],[]\r\n  #描述\r\n  doc.css(\'#incontent .entry p\').each do |d|\r\n    desc_arr << d.text\r\n  end\r\n\r\n  #图片组\r\n  doc.css(\'#incontent .entry p img\').each do |d|\r\n    img_arr << d[\'src\'] + \'@@ \'\r\n  end\r\n\r\n  page_desc = desc_arr.join(\'##\')\r\n  page_images = img_arr.join(\'##\')\r\n\r\n  #标签\r\nend\r\n',3,0,'',0),(19,'加意','jiae','http://jiae.com/idea','.pin-detail-pin img',NULL,1,1,'2013-11-27','2013-11-28','\\/idea\\/','\\/search','# \\/idea\\/\r\n\r\n#描述\r\nif doc.at_css(\'p.pin-desc em\').present?\r\n  page_desc = doc.at_css(\'p.pin-desc em\').text\r\nend\r\n#图片组\r\nif doc.css(\'p.pin-detail-pin img\').present?\r\n  img_arr = []\r\n  doc.css(\'p.pin-detail-pin img\').each do |d|\r\n    if d[\'src\'].present?\r\n      img_arr << d[\'src\'] + \'@@ \'\r\n    end\r\n  end\r\n  page_images = img_arr.join(\'##\')\r\nend\r\n\r\n#分类1\r\ntag_arr = []\r\nif doc.at_css(\'div#PinDetailContainer .pin-board-name\').present?\r\n  tag_arr << doc.at_css(\'div#PinDetailContainer .pin-board-name\').text\r\nend\r\n#标签2\r\nif doc.css(\'p.tag-list a\').present?\r\n  doc.css(\'p.tag-list a\').each do |d|\r\n    tag_arr << d.text\r\n  end\r\nend\r\n\r\npage_tags = tag_arr.join(\'##\')',3,0,'',0),(20,'youthe','youthe','http://www.youthedesigner.com/','#content p .pibfi_pinterest img',NULL,1,1,'2013-11-28','2013-11-29','','\\/category\\/','#标题\r\nif doc.css(\'#content .post-single h1\').present?\r\n  page_title = doc.at_css(\'#content .post-single h1\').text\r\nend\r\n\r\n##描述\r\nif doc.css(\'#content p\').present?\r\n  desc_arr = []\r\n  doc.css(\'#content p\').each do |d|\r\n    desc_arr << d.text\r\n  end\r\nend\r\n\r\n#图片组\r\nif doc.css(\'#content p .pibfi_pinterest\').present?\r\n  img_arr = []\r\n  doc.css(\'#content p .pibfi_pinterest\').each do |d|\r\n    if d.at_css(\'img\').present?\r\n      img_arr << d.at_css(\'img\')[\'src\'] + \'@@ \' \r\n    end\r\n\r\n  end\r\nend\r\n\r\n#标签\r\n\r\npage_desc = desc_arr.join(\'##\')\r\npage_images = img_arr.join(\'##\')',3,0,'',1),(21,'理想生活实验室','toodaylab','http://www.toodaylab.com/','.PostContent p img',NULL,1,1,'2013-11-29','2013-12-01','\\/\\d.*','','#标题\r\nif doc.css(\'.PostHead h1\').present?\r\n  page_title = doc.at_css(\'.PostHead h1\').text\r\nend\r\n\r\n#描述\r\nif doc.css(\'.PostContent p\').present?\r\n  desc_arr = []\r\n  doc.css(\'.PostContent p\').each do |d|\r\n    desc_arr << d.text\r\n  end\r\n  if desc_arr.last.include?(\'标签：\')\r\n    desc_arr[desc_arr.size-1] = desc_arr.last.sub(/标签：.*/,  \'\')\r\n  end\r\n  page_desc = desc_arr.join(\'##\')\r\nend\r\n\r\n#图片组\r\nif doc.css(\'.PostContent p img\').present?\r\n  img_arr = []\r\n  doc.css(\'.PostContent p img\').each do |d|\r\n    img_arr << d[\'src\'] + \'@@ \'\r\n  end\r\n  page_images = img_arr.join(\'##\')\r\nend\r\n\r\n\r\n#标签\r\nif doc.css(\'.Post p\').present?\r\n  tag_arr = []\r\n  doc.css(\'.Post p\').each do |d|\r\n    if d.text[0..1] == \'标签\'\r\n      d.css(\'a\').each do |m|\r\n        tag_arr << m.text\r\n      end\r\n    end\r\n  end\r\n  page_tags = tag_arr.join(\'##\')\r\nend',10,0,'',0);
/*!40000 ALTER TABLE `sites` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2013-12-02 10:35:07
